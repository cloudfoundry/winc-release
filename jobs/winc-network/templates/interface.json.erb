<%=
  def parse_ip (ip, var_name)
    unless ip.empty?
      ip = ip.split(":")[0]
	begin
	  parsed = IPAddr.new ip
	rescue  => e
	  raise "Invalid #{var_name} '#{ip}': #{e}"
	end
    end
  end

  def parse_ips(ips, var_name)
    ips.each do |ip|
      parse_ip(ip, var_name)
    end
  end

  parse_ips(p('winc_network.dns_servers'), 'winc_network.dns_servers')

  toRender = {
    "mtu" => p("winc_network.mtu"),
    "network_name" => "winc-nat",
    "subnet_range" => "172.30.0.0/22",
    "gateway_address" => "172.30.0.1",
    "dns_servers" => p("winc_network.dns_servers"),
    "maximum_outgoing_bandwidth" => p("winc_network.maximum_outgoing_bandwidth"),
  }

  JSON.pretty_generate(toRender)
%>
